---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import BentoCard from '../../components/BentoCard.astro';
import TagComponent from '../../components/Tag.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  const tags = new Set<string>();
  
  posts.forEach(post => {
    post.data.tags?.forEach(tag => tags.add(tag));
  });

  return Array.from(tags).map(tag => ({
    params: { tag },
    props: { tag },
  }));
}

const { tag } = Astro.props;
const posts = await getCollection('blog');
const filteredPosts = posts.filter(post => 
  post.data.tags?.includes(tag)
);
---

<Layout title={`Posts tagged with "${tag}"`}>
  <div class="bento-item tag-hero">
    <div class="tag-hero-inner">
      <h1>Posts tagged with <TagComponent tag={tag} /></h1>
      <span class="count">{filteredPosts.length} post{filteredPosts.length === 1 ? '' : 's'} found</span>
    </div>
  </div>

  {filteredPosts.map(post => (
    <BentoCard
      title={post.data.title}
      description={post.data.description}
      image={post.data.image}
      slug={post.slug}
      tags={post.data.tags}
    />
  ))}
</Layout>

<style>
  .tag-hero {
    grid-column: 3 / span 4;
    grid-row: span 1;
    display: flex;
    align-items: center;
  }

  .tag-hero-inner {
    display: flex;
    align-items: center;
    justify-content: space-between; /* 标题左，数量右 */
    gap: 1rem;
    flex-wrap: wrap;
    width: 100%;
  }

  h1 {
    font-size: 2rem;
    margin: 0;
    background: linear-gradient(135deg, var(--accent-color), #2563eb);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    flex: 1 1 auto;
    min-width: 0;
  }

  .count {
    opacity: 0.85;
    font-weight: 500;
    flex: 0 0 auto;
    white-space: nowrap;
  }
</style>
